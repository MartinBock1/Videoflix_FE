<app-header [actionLink]="'/auth/login'" [actionText]="'Sign in'"></app-header>

<main class="content flex-center">
    <form [formGroup]="confirmPasswordForm" (ngSubmit)="onSubmit()" class="std_form_small" novalidate>
        <h1>Reset password</h1>
        <p class="form_description">Create a new password for your Videoflix account.</p>
        
        <!-- Password Field -->
        <div class="form_group" [class.error]="isFieldInvalid('password')">
            <img src="/icons/password.png" alt="Icon">
            <input 
                [type]="showPassword ? 'text' : 'password'" 
                id="password" 
                formControlName="password"
                placeholder="Password"
                autocomplete="new-password"
                required>
            <label for="password">Password</label>
            <img 
                (click)="togglePassword()" 
                class="password_eye" 
                [src]="showPassword ? '/icons/visibility_off.svg' : '/icons/visibility.svg'"
                alt="Toggle password visibility">
            @if (isFieldInvalid('password')) {
                <p class="error_label">Password must be at least 8 characters long.</p>
            }
        </div>

        <!-- Confirm Password Field -->
        <div class="form_group" [class.error]="isFieldInvalid('confirmPassword')">
            <img src="/icons/password.png" alt="Icon">
            <input 
                [type]="showConfirmPassword ? 'text' : 'password'" 
                id="confirmPassword" 
                formControlName="confirmPassword"
                placeholder="Confirm password"
                autocomplete="new-password"
                required>
            <label for="confirmPassword">Confirm password</label>
            <img 
                (click)="toggleConfirmPassword()" 
                class="password_eye" 
                [src]="showConfirmPassword ? '/icons/visibility_off.svg' : '/icons/visibility.svg'"
                alt="Toggle confirm password visibility">
            @if (isFieldInvalid('confirmPassword')) {
                <p class="error_label">Passwords do not match.</p>
            }
        </div>

        <!-- Success Message -->
        @if (passwordReset) {
            <div class="success_message">
                <img src="/icons/check_circle.svg" alt="Success">
                <p>Password successfully reset! You can now log in with your new password.</p>
            </div>
        }

        <!-- Error Message -->
        @if (errorMessage) {
            <p class="error_message">{{ errorMessage }}</p>
        }

        <!-- Submit Button -->
        <div class="form_actions">
            <button 
                type="submit" 
                class="std_btn btn_prime"
                [disabled]="confirmPasswordForm.invalid || isSubmitting || passwordReset">
                {{ isSubmitting ? 'Resetting...' : 'Reset password' }}
            </button>
        </div>

        <!-- Success Actions -->
        @if (passwordReset) {
            <div class="form_footer">
                <a routerLink="/auth/login" class="std_btn btn_secondary">
                    Go to Login
                </a>
            </div>
        }
    </form>
</main>

<app-footer></app-footer>
